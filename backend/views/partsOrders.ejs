<!DOCTYPE html>
<html>
<head>
  <title>Parts Orders</title>
  <style>
    body { font-family: Arial; margin: 30px; background:#f6f8fa; }
    h1 { text-align:center; color:#06122d; }
    table { width:100%; border-collapse:collapse; background:white; }
    th,td { padding:10px; border-bottom:1px solid #ddd; text-align:center; }
    th { background:#06122d; color:white; }
    .status-select { padding:5px; }
    .submit-btn {
      background:#0070d2; color:white; border:none;
      padding:10px 20px; border-radius:6px; cursor:pointer;
      margin-top:20px;
    }
  </style>
</head>
<body>


<h1>Parts Orders</h1>

<table>
  <thead>
    <tr>
      <th>Manufacturer Order</th>
      <th>Salesforce Order</th>
      <th>Dealer</th>
      <th>Parts</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody>
  <% if (orders.length === 0) { %>
    <tr><td colspan="5">No Parts Orders</td></tr>
  <% } else { %>
    <% orders.forEach((o,i)=>{ %>
      <tr>
        <td><%= o.manufacturerOrderNo %></td>
        <td><%= o.salesOrderNo %></td>
        <td><%= o.dealerName %></td>
        <td><%= o.parts.join(", ") %></td>
        <td>
          <select class="status-select" data-index="<%= i %>">
            <option <%= o.status==="Acknowledged"?"selected":"" %>>Acknowledged</option>
            <option <%= o.status==="Allocated"?"selected":"" %>>Allocated</option>
            <option <%= o.status === "In Production" ? "selected" : "" %>>In Production</option>
            <option <%= o.status === "In Paint" ? "selected" : "" %>>In Paint</option>
            <option <%= o.status === "In Voiced" ? "selected" : "" %>>In Voiced</option>
            <option <%= o.status==="In Transit"?"selected":"" %>>In Transit</option>
            <option <%= o.status==="Delivered"?"selected":"" %>>Delivered</option>
          </select>
        </td>
      </tr>
    <% }) %>
  <% } %>
  </tbody>
</table>

<div style="text-align:center;">
  <button class="submit-btn" id="submitBtn">Submit Status</button>
</div>

<script>
  const orders = <%- JSON.stringify(orders) %>;

  document.getElementById("submitBtn").onclick = async () => {
    document.querySelectorAll(".status-select").forEach((s,i)=>{
      if (orders[i]) orders[i].status = s.value;
    });

    await fetch("/submit-statuses", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ orders })
    });

    alert("Parts order status updated");
  };
</script>

</body>
</html>
