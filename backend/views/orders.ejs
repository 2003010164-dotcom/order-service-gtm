<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manufacturer Orders</title>
  <style>
    body { font-family:"Segoe UI",Arial,sans-serif;background:#f6f8fa;margin:30px;color:#111827; }
    h1 { text-align:center;color:#06122d;font-weight:600;margin-bottom:25px; }
    table { width:100%;border-collapse:collapse;margin-top:20px;background:#ffffff;border-radius:10px;overflow:hidden;box-shadow:0 3px 6px rgba(0,0,0,0.08); }
    td,th { border-bottom:1px solid #e5e7eb;padding:10px 12px;text-align:center;font-size:14px; }
    th { background-color:#06122d;color:white;font-weight:500; }
    tr:hover { background-color:#f1f5ff; }
    .status-select { border:1px solid #d1d5db;border-radius:5px;padding:5px 8px;background-color:#f9fafb;font-size:14px; }
    .submit-btn { background-color:#0070d2;color:white;border-radius:6px;padding:8px 16px;border:none;cursor:pointer;font-weight:600;margin-top:20px; }
    .submit-btn:hover { background-color:#005fb2; }
  </style>
</head>
<body>
<%- include('partials/navbar') %>
  <h1>Manufacturer Orders</h1>
 
  <table>
    <thead>
      <tr>
        <th>Manufacturer Order No.</th>
        <th>Salesforce Order No.</th>
        <th>Dealer Name</th>
        <th>Vehicle</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <% if (orders.length === 0) { %>
        <tr><td colspan="5">No Orders Found</td></tr>
      <% } else { %>
        <% orders.forEach((order, index) => { %>
          <tr>
            <td><%= order.manufacturerOrderNo %></td>
            <td><%= order.salesOrderNo %></td>
            <td><%= order.dealerName %></td>
            <td><%= order.vehicle.join(", ") %></td>
            <td>
              <select class="status-select" data-index="<%= index %>">
                <option value="Acknowledged" <%= order.status === "Acknowledged" ? "selected" : "" %>>Acknowledged</option>
                <option value="Allocated" <%= order.status === "Allocated" ? "selected" : "" %>>Allocated</option>
                <option value="In Production" <%= order.status === "In Production" ? "selected" : "" %>>In Production</option>
                <option value="In Paint" <%= order.status === "In Paint" ? "selected" : "" %>>In Paint</option>
                <option value="In Voiced" <%= order.status === "In Voiced" ? "selected" : "" %>>In Voiced</option>
                <option value="In Transit" <%= order.status === "In Transit" ? "selected" : "" %>>In Transit</option>
                <option value="Delivered" <%= order.status === "Delivered" ? "selected" : "" %>>Delivered</option>
              </select>
            </td>
          </tr>
        <% }) %>
      <% } %>
    </tbody>
  </table>
 
  <div style="text-align:center;">
  <button class="submit-btn" id="submitBtn">Submit Status</button>
  <button class="submit-btn" id="deliveryBtn" style="margin-left:10px;">Delivery Duration</button>
</div>
 
  <script>
    const orders = <%- JSON.stringify(orders) %>;
 
    document.getElementById("submitBtn").addEventListener("click", async (e) => {
      e.preventDefault();
      const selects = document.querySelectorAll(".status-select");
 
      selects.forEach((select, i) => {
        if (orders[i]) orders[i].status = select.value;
      });
 
      console.log(" Sending to /submit-statuses:", orders);
 
      try {
        const res = await fetch("/submit-statuses", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ orders })
        });
 
        const text = await res.text();
        console.log(" Response:", text);
 
        if (res.ok) alert(" Fulfillment Orders created successfully!");
        else alert(" Error: " + text);
      } catch (err) {
        console.error("Network error:", err);
        alert("Network error: " + err.message);
      }
    });

// Redirect to Delivery Duration page
document.getElementById("deliveryBtn").addEventListener("click", () => {
  window.location.href = "/delivery-duration";
});
  </script>
</body>
